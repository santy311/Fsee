{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 12, "column": 0}, "map": {"version":3,"sources":["file:///Users/santhosh/Documents/Turbin3/f4see/app/src/app/utils/ProgramUtils.ts"],"sourcesContent":["import { Program, AnchorProvider, Idl, setProvider, BN } from \"@coral-xyz/anchor\";\nimport {\n  PublicKey,\n  Connection,\n  Keypair,\n  ConfirmOptions,\n  TransactionMessage,\n  VersionedTransaction,\n  Transaction,\n  TransactionInstruction,\n} from \"@solana/web3.js\";\n\nimport idl from \"../solana/idl/fsee.json\";\nimport { Fsee } from \"../solana/types/fsee\";\nimport { getAccount, getAssociatedTokenAddressSync, createAssociatedTokenAccountInstruction, TokenAccountNotFoundError, TokenInvalidAccountOwnerError } from '@solana/spl-token';\nimport { useConnection, useWallet } from '@solana/wallet-adapter-react';\n\nexport const CONFIRM_OPTIONS: ConfirmOptions = { commitment: \"finalized\" };\n\n// Types\nexport interface Market {\n  creator: PublicKey;\n  title: string;\n  desc: string;\n  icon: string;\n  seed: number;\n  publicKey: PublicKey;\n  resolved: boolean;\n  outcome: boolean | null;\n  liquidity: number;\n  yesAmount: number;\n  noAmount: number;\n  userYesBalance?: number;\n  userNoBalance?: number;\n  userLpBalance?: number;\n}\n\ninterface PriceResult {\n  priceA: number;\n  priceB: number;\n  priceABigInt: bigint;\n  priceBBigInt: bigint;\n}\n\nexport class ProgramUtils {\n  private program: Program<Fsee>;\n  private provider: AnchorProvider;\n  private readonly PRECISION = BigInt(10000);\n\n  constructor(connection: Connection, wallet: any) {\n    this.provider = new AnchorProvider(\n      connection,\n      wallet,\n      AnchorProvider.defaultOptions()\n    );\n    setProvider(this.provider);\n\n    const programId = new PublicKey(idl.address);\n    console.log(\"Program ID from IDL:\", programId.toString());\n\n    this.program = new Program(idl as Idl, this.provider) as unknown as Program<Fsee>;\n\n  }\n\n  async initializeMarket(\n    seed: number,\n    title: string,\n    description: string,\n    icon: string,\n  ): Promise<PublicKey> {\n    try {\n\n      const descriptionJSON = {\n        title: title,\n        desc: description,\n        icon: icon,\n      }\n      const descriptionString = JSON.stringify(descriptionJSON);\n\n      const seed_bn = new BN(seed);\n\n      const market = PublicKey.findProgramAddressSync(\n        [\n          Buffer.from(\"market\"),\n          this.provider.wallet.publicKey.toBuffer(),\n          Buffer.from(seed_bn.toArrayLike(Buffer, \"le\", 8)),\n        ],\n        new PublicKey(idl.address)\n      )[0];\n\n      const transaction = new Transaction();\n\n      const tx_ix1 = await this.program.methods\n        .initializeMarket(\n          seed_bn,\n          descriptionString,\n        )\n        .accounts({\n          creator: this.provider.wallet.publicKey,\n          usdcMint: new PublicKey(process.env.NEXT_PUBLIC_USDC_MINT!),\n        })\n        .instruction();\n\n      const tx_ix2 = await this.program.methods\n        .initializeNoMints()\n        .accountsPartial({\n          creator: this.provider.wallet.publicKey,\n          market: market,\n        })\n        .instruction();\n\n      const tx_ix3 = await this.program.methods\n        .initializeYesMints()\n        .accountsPartial({\n          creator: this.provider.wallet.publicKey,\n          market: market,\n        })\n        .instruction();\n\n      transaction.add(tx_ix1, tx_ix2, tx_ix3);\n\n      const hash = await this.provider.sendAll([{tx: transaction}], {commitment: \"finalized\"});\n\n      console.log(\"Transaction hash:\", hash);\n\n      console.log(\"Market created with address:\", market.toBase58());\n\n      console.log(\"market\", await this.getMarket(market));\n\n\n      return market;\n    } catch (error) {\n      console.error(\"Error in initializeMarket:\", error);\n      throw error;\n    }\n  }\n\n  async addLiquidity(market: PublicKey, amount: number): Promise<string> {\n    console.log(\"Adding liquidity to market:\", market.toBase58());\n    console.log(\"Amount:\", amount);\n    console.log(\"user\", this.provider.wallet.publicKey);\n    const ata_ixs = await this.createATAs(market, this.provider.wallet.publicKey);\n    console.log(\"ata_ixs\", ata_ixs);\n    const ix = await this.program.methods\n    .addLiquidity(new BN(amount))\n    .accountsPartial({\n        liquidityProvider: this.provider.wallet.publicKey,\n        usdcMint: new PublicKey(process.env.NEXT_PUBLIC_USDC_MINT!),\n        market: market,\n    })\n    .instruction();\n\n    const latestBlockhash = await this.provider.connection.getLatestBlockhash()\n\n    // Create a new TransactionMessage with version and compile it to version 0\n    const messageV0 = new TransactionMessage({\n        payerKey: this.provider.wallet.publicKey,\n        recentBlockhash: latestBlockhash.blockhash,\n        instructions: [...ata_ixs, ix],\n    }).compileToV0Message();\n\n    // Create a new VersionedTransacction to support the v0 message\n    const transaction = new VersionedTransaction(messageV0)\n\n    // Send transaction and await for signature\n    const signature = await this.provider.sendAll([{tx: transaction}], CONFIRM_OPTIONS);\n\n    console.log(\"Signature:\", signature);\n\n    return signature[0];\n  }\n\n  async buy(\n    market: PublicKey,\n    buyingYes: boolean,\n    amount: number\n  ): Promise<string> {\n    const tx = await this.program.methods\n    .buy(buyingYes, new BN(amount))\n    .accountsPartial({\n        predictor: this.provider.wallet.publicKey,\n        usdcMint: new PublicKey(process.env.NEXT_PUBLIC_USDC_MINT!),\n        market: market,\n    })\n    .rpc(CONFIRM_OPTIONS);\n    console.log(\"tx\", tx);\n\n    return tx;\n  }\n\n  async resolveMarket(market: PublicKey, outcome: boolean): Promise<string> {\n    const tx = await this.program.methods\n    .resolveMarket(outcome)\n    .accountsPartial({\n        predictor: this.provider.wallet.publicKey,\n        market: market,\n    })\n    .rpc(CONFIRM_OPTIONS);\n    console.log(\"tx\", tx);\n\n    return tx;\n  }\n\n  async redeemTokens(\n    market: PublicKey,\n    yesAmount: number,\n    noAmount: number\n  ): Promise<string> {\n    const tx = await this.program.methods\n    .redeemTokens(new BN(yesAmount), new BN(noAmount))\n    .accountsPartial({\n        predictor: this.provider.wallet.publicKey,\n        usdcMint: new PublicKey(process.env.NEXT_PUBLIC_USDC_MINT!),\n        market: market,\n    })\n    .rpc(CONFIRM_OPTIONS);\n    console.log(\"tx\", tx);\n\n    return tx;\n  }\n\n  async removeLiquidity(market: PublicKey, amount: number): Promise<string> {\n    const tx = await this.program.methods\n    .removeLiquidity(new BN(amount))\n    .accountsPartial({\n        liquidityProvider: this.provider.wallet.publicKey,\n        usdcMint: new PublicKey(process.env.NEXT_PUBLIC_USDC_MINT!),\n        market: market,\n    })\n    .rpc(CONFIRM_OPTIONS);\n    console.log(\"tx\", tx);\n\n    return tx;\n  }\n\n  private async createATAs(market: PublicKey, user: PublicKey): Promise<TransactionInstruction[]> {\n    const marketAccount = await this.program.account.market.fetch(market);\n    const yes_ix = await this.createTokenAccountInstruction(market, user, marketAccount.yesMint);\n    const no_ix = await this.createTokenAccountInstruction(market, user, marketAccount.noMint);\n    const lp_ix = await this.createTokenAccountInstruction(market, user, marketAccount.lpMint);\n    const ixs = [yes_ix, no_ix, lp_ix];\n    // Filter out null instructions and match the return type\n    return ixs.filter((ix) => ix !== null) as TransactionInstruction[];\n  }\n\n  private async getAtas(market: PublicKey, user: PublicKey): Promise<[PublicKey, PublicKey, PublicKey, PublicKey]> {\n    const marketAccount = await this.program.account.market.fetch(market);\n    const yesAta = await getAssociatedTokenAddressSync(marketAccount.yesMint, user, true);\n    const noAta = await getAssociatedTokenAddressSync(marketAccount.noMint, user, true);\n    const lpAta = await getAssociatedTokenAddressSync(marketAccount.lpMint, user, true);\n    const usdcAta = await getAssociatedTokenAddressSync(new PublicKey(process.env.NEXT_PUBLIC_USDC_MINT!), user, true);\n    return [yesAta, noAta, lpAta, usdcAta];\n  }\n\n  private async createTokenAccountInstruction(market: PublicKey, user: PublicKey, mint: PublicKey): Promise<TransactionInstruction | null> {\n    const associatedToken = await getAssociatedTokenAddressSync(\n        mint,\n        user,\n    );\n    \n    let account;\n    try {\n        account = await getAccount(this.provider.connection, associatedToken);\n        return null;\n    } catch (error: unknown) {\n      if (error instanceof TokenAccountNotFoundError || error instanceof TokenInvalidAccountOwnerError) {\n        try {\n            const ix = createAssociatedTokenAccountInstruction(\n                        user,\n                        associatedToken,\n                        user,\n                        mint,\n                    );\n\n            return ix;\n        } catch (error: unknown) {\n            throw error;\n        }\n      } else {\n        throw error;\n      }\n    }\n    return account;\n  }\n\n  public async getMarkets(): Promise<Market[]> {\n    const markets = await this.program.account.market.all();\n    const market_pdas = await Promise.all(markets.map((market) => market.publicKey));\n    const markets_with_data = await Promise.all(market_pdas.map((market) => this.getMarket(market)));\n    return markets_with_data.filter((market) => market !== null);\n  }\n\n  public async getPrice(\n        market: PublicKey, \n    ): Promise<PriceResult> {\n        const market_account = await this.program.account.market.fetch(market);\n        \n        const market_yes_ata = await getAssociatedTokenAddressSync(market_account.yesMint, market, true);\n        const market_no_ata = await getAssociatedTokenAddressSync(market_account.noMint, market, true);\n        const yes_pool_balance = BigInt((await this.provider.connection.getTokenAccountBalance(market_yes_ata)).value.amount);\n        const no_pool_balance = BigInt((await this.provider.connection.getTokenAccountBalance(market_no_ata)).value.amount);\n        const prices = await this.calculateOutcomeShares(yes_pool_balance, no_pool_balance);\n        return prices;\n    }\n\n    private async calculateOutcomeShares(\n        yes_pool_balance: bigint, \n        no_pool_balance: bigint, \n    ): Promise<PriceResult> {\n        // Input validation\n        if (yes_pool_balance <= BigInt(0) || no_pool_balance <= BigInt(0)) {\n            if (yes_pool_balance == BigInt(0) && no_pool_balance == BigInt(0)) {\n                return {\n                    priceA: 0.5,\n                    priceB: 0.5,\n                    priceABigInt: BigInt(5000),\n                    priceBBigInt: BigInt(5000)\n                };\n            } else if (yes_pool_balance == BigInt(0)) {\n                return {\n                    priceA: 0,\n                    priceB: 1,\n                    priceABigInt: BigInt(0),\n                    priceBBigInt: BigInt(10000)\n                };\n            } else {\n                return {\n                    priceA: 1,\n                    priceB: 0,\n                    priceABigInt: BigInt(10000),\n                    priceBBigInt: BigInt(0)\n                };\n            }\n        }\n  \n        const totalShares = yes_pool_balance + no_pool_balance;\n        const priceABigInt = (no_pool_balance * this.PRECISION) / totalShares;\n        const priceBBigInt = (yes_pool_balance * this.PRECISION) / totalShares;\n  \n        const priceA = Number(priceABigInt) / Number(this.PRECISION);\n        const priceB = Number(priceBBigInt) / Number(this.PRECISION);\n  \n        const sum = priceA + priceB;\n        if (Math.abs(sum - 1) > 0.0001) {\n            throw new Error('Invalid prices - must sum to 1');\n        }\n  \n        return {\n            priceA,\n            priceB,\n            priceABigInt,\n            priceBBigInt\n        };\n    }\n\n  private async getUserTokenBalances(market: PublicKey, user: PublicKey): Promise<[number, number, number]> {\n    try {\n      const marketAccount = await this.program.account.market.fetch(market);\n      const yesAta = await getAssociatedTokenAddressSync(marketAccount.yesMint, user, true);\n      const noAta = await getAssociatedTokenAddressSync(marketAccount.noMint, user, true);\n      const lpAta = await getAssociatedTokenAddressSync(marketAccount.lpMint, user, true);\n      \n      const [yesBalance, noBalance, lpBalance] = await Promise.all([\n        this.getTokenBalance(yesAta),\n        this.getTokenBalance(noAta),\n        this.getTokenBalance(lpAta)\n      ]);\n\n      return [yesBalance, noBalance, lpBalance];\n    } catch (error) {\n      console.error(\"Error getting user token balances:\", error);\n      return [0, 0, 0];\n    }\n  }\n\n  private async getTokenBalance(ata: PublicKey): Promise<number> {\n    try {\n      const account = await getAccount(this.provider.connection, ata);\n      return Number(account.amount);\n    } catch (e) {\n      return 0;\n    }\n  }\n\n  public async getMarket(marketPda: PublicKey): Promise<Market | null> {\n    const market = await this.program.account.market.fetch(marketPda);\n    console.log(\"market\", market);\n    const description = JSON.parse(market.description);\n    \n    const [usdcAta] = await this.getAtas(marketPda, marketPda);\n    const usdcBalance = await this.provider.connection.getTokenAccountBalance(usdcAta);\n    const prices = await this.getPrice(marketPda);\n    \n    let userYesBalance = 0;\n    let userNoBalance = 0;\n    let userLpBalance = 0;\n    if (this.provider.wallet.publicKey) {\n      [userYesBalance, userNoBalance, userLpBalance] = await this.getUserTokenBalances(\n        marketPda, \n        this.provider.wallet.publicKey\n      );\n    }\n\n    return {\n      creator: market.creator,\n      title: description.title,\n      desc: description.desc,\n      icon: description.icon,\n      publicKey: marketPda,\n      resolved: market.resolved,\n      outcome: market.outcome,\n      seed: Number(market.seed),\n      liquidity: Number(usdcBalance.value.amount),\n      yesAmount: prices.priceA,\n      noAmount: prices.priceB,\n      userYesBalance,\n      userNoBalance,\n      userLpBalance,\n    };\n  }\n}\n\n// Hook to create ProgramUtils instance\nexport const useProgramUtils = () => {\n  const { connection } = useConnection();\n  const { publicKey, signTransaction, signAllTransactions } = useWallet();\n  \n  if (!publicKey || !signTransaction || !signAllTransactions) {\n    return null;\n  }\n\n  const wallet = {\n    publicKey,\n    signTransaction,\n    signAllTransactions,\n    payer: Keypair.generate(),\n  };\n\n  return new ProgramUtils(connection, wallet);\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 352, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 358, "column": 0}, "map": {"version":3,"sources":["file:///Users/santhosh/Documents/Turbin3/f4see/app/src/app/components/ShareButton.tsx"],"sourcesContent":["\"use client\";\n\nimport { ShareIcon } from \"@heroicons/react/24/outline\";\nimport { PublicKey } from \"@solana/web3.js\";\n\ninterface ShareButtonProps {\n  marketAddress: PublicKey;\n  className?: string;\n}\n\nexport function ShareButton({\n  marketAddress,\n  className = \"\",\n}: ShareButtonProps) {\n  const handleShare = () => {\n    const shareUrl = `https://dial.to/?action=solana-action:http://localhost:3001/api/donate?address=${marketAddress.toString()}`;\n\n    // Copy to clipboard\n    navigator.clipboard.writeText(shareUrl);\n\n    // Open in new tab\n    window.open(shareUrl, \"_blank\");\n  };\n\n  return (\n    <button\n      onClick={handleShare}\n      className={`p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors text-white ${className}`}\n      title=\"Share market\"\n    >\n      <ShareIcon className=\"w-5 h-5\" />\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AAFA;;;AAUO,SAAS,YAAY,EAC1B,aAAa,EACb,YAAY,EAAE,EACG;IACjB,MAAM,cAAc;QAClB,MAAM,WAAW,CAAC,+EAA+E,EAAE,cAAc,QAAQ,IAAI;QAE7H,oBAAoB;QACpB,UAAU,SAAS,CAAC,SAAS,CAAC;QAE9B,kBAAkB;QAClB,OAAO,IAAI,CAAC,UAAU;IACxB;IAEA,qBACE,6LAAC;QACC,SAAS;QACT,WAAW,CAAC,0EAA0E,EAAE,WAAW;QACnG,OAAM;kBAEN,cAAA,6LAAC,oNAAA,CAAA,YAAS;YAAC,WAAU;;;;;;;;;;;AAG3B;KAvBgB"}},
    {"offset": {"line": 397, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 403, "column": 0}, "map": {"version":3,"sources":["file:///Users/santhosh/Documents/Turbin3/f4see/app/src/app/components/CompletedMarketDetailsModal.tsx"],"sourcesContent":["\"use client\";\n\nimport { Dialog } from \"@headlessui/react\";\nimport { Market, ProgramUtils } from \"../utils/ProgramUtils\";\nimport { Connection } from \"@solana/web3.js\";\nimport { useWallet } from \"@solana/wallet-adapter-react\";\nimport { useState } from \"react\";\nimport Image from \"next/image\";\nimport { ShareButton } from \"./ShareButton\";\n\ninterface Props {\n  isOpen: boolean;\n  onClose: () => void;\n  market: Market;\n  onRedeem: (market: Market) => Promise<void>;\n  isRedeeming: boolean;\n}\n\nexport function CompletedMarketDetailsModal({\n  isOpen,\n  onClose,\n  market,\n  onRedeem,\n  isRedeeming,\n}: Props) {\n  const [isRemovingLiquidity, setIsRemovingLiquidity] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const wallet = useWallet();\n\n  const handleRemoveLiquidity = async () => {\n    if (!wallet.publicKey) {\n      setError(\"Please connect your wallet first\");\n      return;\n    }\n\n    setIsRemovingLiquidity(true);\n    setError(null);\n\n    try {\n      const connection = new Connection(\n        process.env.NEXT_PUBLIC_RPC_URL || \"https://api.devnet.solana.com\"\n      );\n      const programUtils = new ProgramUtils(connection, wallet);\n      const tx = await programUtils.removeLiquidity(\n        market.publicKey,\n        market.userLpBalance || 0\n      );\n      console.log(\"Liquidity removed successfully. Transaction signature:\", tx);\n      onClose();\n    } catch (err) {\n      console.error(\"Error removing liquidity:\", err);\n      setError(\n        err instanceof Error ? err.message : \"Failed to remove liquidity\"\n      );\n    } finally {\n      setIsRemovingLiquidity(false);\n    }\n  };\n\n  const hasTokens =\n    (market.userYesBalance || 0) > 0 || (market.userNoBalance || 0) > 0;\n\n  return (\n    <Dialog open={isOpen} onClose={onClose} className=\"relative z-50\">\n      <div\n        className=\"fixed inset-0 bg-black/30 backdrop-blur-sm\"\n        aria-hidden=\"true\"\n      />\n      <div className=\"fixed inset-0 flex items-center justify-center p-4\">\n        <Dialog.Panel className=\"bg-background rounded-xl p-6 max-w-2xl w-full relative\">\n          <div className=\"absolute top-4 right-4 z-10\">\n            <ShareButton marketAddress={market.publicKey} />\n          </div>\n          {/* Image Section */}\n          <div className=\"relative w-full h-[300px] rounded-lg overflow-hidden mb-6\">\n            <img\n              src={market.icon}\n              alt={market.title}\n              className=\"absolute inset-0 w-full h-full object-cover\"\n            />\n            <div className=\"absolute bottom-0 left-0 right-0 bg-black/50 backdrop-blur-sm p-2 flex flex-col gap-1\">\n              <div className=\"flex justify-between text-sm\">\n                <span className=\"text-green-400\">\n                  YES: {(market.yesAmount * 100).toFixed(1)}%\n                </span>\n                <span className=\"text-red-400\">\n                  NO: {(market.noAmount * 100).toFixed(1)}%\n                </span>\n              </div>\n              <div className=\"text-sm text-white/80\">\n                Final Liquidity: {market.liquidity.toFixed(2)} USDC\n              </div>\n            </div>\n          </div>\n\n          <Dialog.Title className=\"text-xl font-bold mb-2\">\n            {market.title}\n          </Dialog.Title>\n          <p className=\"text-white/60 text-sm mb-6\">{market.desc}</p>\n\n          {/* Add token balance display */}\n          <div className=\"p-4 bg-white/5 rounded-lg mb-6\">\n            <div className=\"flex justify-between mb-2\">\n              <span className=\"text-white/60\">Your YES tokens:</span>\n              <span className=\"text-white\">\n                {(market.userYesBalance || 0).toFixed(2)}\n              </span>\n            </div>\n            <div className=\"flex justify-between\">\n              <span className=\"text-white/60\">Your NO tokens:</span>\n              <span className=\"text-white\">\n                {(market.userNoBalance || 0).toFixed(2)}\n              </span>\n            </div>\n          </div>\n\n          {/* Add LP balance display if exists */}\n          {market.userLpBalance && market.userLpBalance > 0 && (\n            <div className=\"p-4 bg-white/5 rounded-lg mb-6\">\n              <div className=\"flex justify-between mb-2\">\n                <span className=\"text-white/60\">Your LP tokens:</span>\n                <span className=\"text-white\">\n                  {market.userLpBalance.toFixed(2)} LP\n                </span>\n              </div>\n              <button\n                onClick={handleRemoveLiquidity}\n                disabled={isRemovingLiquidity}\n                className=\"w-full bg-red-600/20 hover:bg-red-600/30 text-red-500 py-2 rounded-lg text-sm font-medium mt-2 disabled:opacity-50 disabled:cursor-not-allowed\"\n              >\n                {isRemovingLiquidity\n                  ? \"Removing Liquidity...\"\n                  : \"Remove Liquidity\"}\n              </button>\n            </div>\n          )}\n\n          {/* Market Result */}\n          <div className=\"p-4 bg-white/5 rounded-lg mb-6\">\n            <p className=\"text-center text-lg\">\n              Result:{\" \"}\n              <span\n                className={market.outcome ? \"text-green-500\" : \"text-red-500\"}\n              >\n                {market.outcome ? \"YES\" : \"NO\"}\n              </span>\n            </p>\n          </div>\n\n          {/* Redeem Button - only show if user has tokens */}\n          {hasTokens ? (\n            <button\n              onClick={() => onRedeem(market)}\n              disabled={isRedeeming}\n              className=\"w-full bg-green-600/20 hover:bg-green-600/30 text-green-500 py-3 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed mb-4\"\n            >\n              {isRedeeming ? \"Processing...\" : \"Redeem Winnings\"}\n            </button>\n          ) : (\n            <p className=\"text-white/60 text-sm text-center mb-4\">\n              You do not have any tokens to redeem for this market\n            </p>\n          )}\n\n          <button\n            onClick={onClose}\n            className=\"w-full bg-white/5 hover:bg-white/10 text-white py-2 rounded-lg text-sm font-medium transition-colors\"\n          >\n            Close\n          </button>\n\n          {error && (\n            <div className=\"mb-4 p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-500 text-sm\">\n              {error}\n            </div>\n          )}\n        </Dialog.Panel>\n      </div>\n    </Dialog>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA;AACA;AAEA;AAEA;AAHA;AAmCQ;AAtCR;;;AAFA;;;;;;;AAkBO,SAAS,4BAA4B,EAC1C,MAAM,EACN,OAAO,EACP,MAAM,EACN,QAAQ,EACR,WAAW,EACL;;IACN,MAAM,CAAC,qBAAqB,uBAAuB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC/D,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAiB;IAClD,MAAM,SAAS,CAAA,GAAA,oLAAA,CAAA,YAAS,AAAD;IAEvB,MAAM,wBAAwB;QAC5B,IAAI,CAAC,OAAO,SAAS,EAAE;YACrB,SAAS;YACT;QACF;QAEA,uBAAuB;QACvB,SAAS;QAET,IAAI;YACF,MAAM,aAAa,IAAI,2KAAA,CAAA,aAAU,CAC/B,6DAAmC;YAErC,MAAM,eAAe,IAAI,sIAAA,CAAA,eAAY,CAAC,YAAY;YAClD,MAAM,KAAK,MAAM,aAAa,eAAe,CAC3C,OAAO,SAAS,EAChB,OAAO,aAAa,IAAI;YAE1B,QAAQ,GAAG,CAAC,0DAA0D;YACtE;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,SACE,eAAe,QAAQ,IAAI,OAAO,GAAG;QAEzC,SAAU;YACR,uBAAuB;QACzB;IACF;IAEA,MAAM,YACJ,CAAC,OAAO,cAAc,IAAI,CAAC,IAAI,KAAK,CAAC,OAAO,aAAa,IAAI,CAAC,IAAI;IAEpE,qBACE,6LAAC,kLAAA,CAAA,SAAM;QAAC,MAAM;QAAQ,SAAS;QAAS,WAAU;;0BAChD,6LAAC;gBACC,WAAU;gBACV,eAAY;;;;;;0BAEd,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC,kLAAA,CAAA,SAAM,CAAC,KAAK;oBAAC,WAAU;;sCACtB,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC,2IAAA,CAAA,cAAW;gCAAC,eAAe,OAAO,SAAS;;;;;;;;;;;sCAG9C,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCACC,KAAK,OAAO,IAAI;oCAChB,KAAK,OAAO,KAAK;oCACjB,WAAU;;;;;;8CAEZ,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDAAK,WAAU;;wDAAiB;wDACzB,CAAC,OAAO,SAAS,GAAG,GAAG,EAAE,OAAO,CAAC;wDAAG;;;;;;;8DAE5C,6LAAC;oDAAK,WAAU;;wDAAe;wDACxB,CAAC,OAAO,QAAQ,GAAG,GAAG,EAAE,OAAO,CAAC;wDAAG;;;;;;;;;;;;;sDAG5C,6LAAC;4CAAI,WAAU;;gDAAwB;gDACnB,OAAO,SAAS,CAAC,OAAO,CAAC;gDAAG;;;;;;;;;;;;;;;;;;;sCAKpD,6LAAC,kLAAA,CAAA,SAAM,CAAC,KAAK;4BAAC,WAAU;sCACrB,OAAO,KAAK;;;;;;sCAEf,6LAAC;4BAAE,WAAU;sCAA8B,OAAO,IAAI;;;;;;sCAGtD,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAK,WAAU;sDAAgB;;;;;;sDAChC,6LAAC;4CAAK,WAAU;sDACb,CAAC,OAAO,cAAc,IAAI,CAAC,EAAE,OAAO,CAAC;;;;;;;;;;;;8CAG1C,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAK,WAAU;sDAAgB;;;;;;sDAChC,6LAAC;4CAAK,WAAU;sDACb,CAAC,OAAO,aAAa,IAAI,CAAC,EAAE,OAAO,CAAC;;;;;;;;;;;;;;;;;;wBAM1C,OAAO,aAAa,IAAI,OAAO,aAAa,GAAG,mBAC9C,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAK,WAAU;sDAAgB;;;;;;sDAChC,6LAAC;4CAAK,WAAU;;gDACb,OAAO,aAAa,CAAC,OAAO,CAAC;gDAAG;;;;;;;;;;;;;8CAGrC,6LAAC;oCACC,SAAS;oCACT,UAAU;oCACV,WAAU;8CAET,sBACG,0BACA;;;;;;;;;;;;sCAMV,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCAAE,WAAU;;oCAAsB;oCACzB;kDACR,6LAAC;wCACC,WAAW,OAAO,OAAO,GAAG,mBAAmB;kDAE9C,OAAO,OAAO,GAAG,QAAQ;;;;;;;;;;;;;;;;;wBAM/B,0BACC,6LAAC;4BACC,SAAS,IAAM,SAAS;4BACxB,UAAU;4BACV,WAAU;sCAET,cAAc,kBAAkB;;;;;iDAGnC,6LAAC;4BAAE,WAAU;sCAAyC;;;;;;sCAKxD,6LAAC;4BACC,SAAS;4BACT,WAAU;sCACX;;;;;;wBAIA,uBACC,6LAAC;4BAAI,WAAU;sCACZ;;;;;;;;;;;;;;;;;;;;;;;AAOf;GAlKgB;;QASC,oLAAA,CAAA,YAAS;;;KATV"}},
    {"offset": {"line": 764, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 770, "column": 0}, "map": {"version":3,"sources":["file:///Users/santhosh/Documents/Turbin3/f4see/app/src/app/markets/completed/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { CompletedMarketDetailsModal } from \"../../components/CompletedMarketDetailsModal\";\nimport { useWallet } from \"@solana/wallet-adapter-react\";\nimport { ProgramUtils, Market } from \"../../utils/ProgramUtils\";\nimport { Connection } from \"@solana/web3.js\";\nimport { ShareButton } from \"../../components/ShareButton\";\n\nexport default function CompletedMarketsPage() {\n  const [selectedMarket, setSelectedMarket] = useState<number | null>(null);\n  const [markets, setMarkets] = useState<Market[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [isRedeeming, setIsRedeeming] = useState<number | null>(null);\n  const wallet = useWallet();\n\n  const loadMarkets = async () => {\n    const connection = new Connection(\n      process.env.NEXT_PUBLIC_RPC_URL || \"https://api.devnet.solana.com\"\n    );\n    console.log(\"wallet\", wallet.publicKey);\n    const programUtils = new ProgramUtils(connection, wallet);\n    const allMarkets = await programUtils.getMarkets();\n    const filteredMarkets = allMarkets.filter(\n      (market) => market.outcome !== null\n    );\n    console.log(\"filteredMarkets\", filteredMarkets);\n    setMarkets(filteredMarkets);\n  };\n\n  useEffect(() => {\n    loadMarkets();\n  }, []);\n\n  const handleRedeem = async (market: Market) => {\n    if (!wallet.publicKey) {\n      setError(\"Please connect your wallet first\");\n      return;\n    }\n\n    setIsRedeeming(market.seed);\n    setError(null);\n\n    try {\n      const connection = new Connection(\n        process.env.NEXT_PUBLIC_RPC_URL || \"https://api.devnet.solana.com\"\n      );\n      const programUtils = new ProgramUtils(connection, wallet);\n      // For now, we're passing 1000 as placeholder amounts. You'll need to get actual token amounts.\n      const tx = await programUtils.redeemTokens(\n        market.publicKey,\n        market.userYesBalance || 0,\n        market.userNoBalance || 0\n      );\n      console.log(\"Redeem successful. Transaction signature:\", tx);\n      await loadMarkets(); // Reload markets to update state\n    } catch (err) {\n      console.error(\"Error redeeming tokens:\", err);\n      setError(err instanceof Error ? err.message : \"Failed to redeem tokens\");\n    } finally {\n      setIsRedeeming(null);\n    }\n  };\n\n  const selectedMarketData = markets.find((m) => m.seed === selectedMarket);\n\n  return (\n    <div className=\"p-4\">\n      <h1 className=\"text-2xl font-bold mb-4\">Completed Markets</h1>\n      {error && (\n        <div className=\"mb-4 p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-500 text-sm\">\n          {error}\n        </div>\n      )}\n      {markets.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {markets.map((market) => (\n            <div\n              key={market.seed}\n              className=\"bg-input-background rounded-xl p-4 flex flex-col gap-4 group\"\n            >\n              {/* Image container with overlay button */}\n              <div className=\"relative pt-[70%] w-full bg-white/5 rounded-lg overflow-hidden\">\n                <img\n                  src={market.icon}\n                  alt={`Market ${market.seed}`}\n                  className=\"absolute top-0 left-0 w-full h-full object-cover\"\n                />\n                <div className=\"absolute top-2 right-2\">\n                  <ShareButton\n                    marketAddress={market.publicKey}\n                    className=\"bg-black/30 hover:bg-black/50\"\n                  />\n                </div>\n                <button\n                  onClick={() => setSelectedMarket(market.seed)}\n                  className=\"absolute inset-0 bg-black/0 group-hover:bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-200\"\n                >\n                  <span className=\"w-10 h-10 rounded-full bg-white/10 backdrop-blur-sm flex items-center justify-center text-white border border-white/20\">\n                    +\n                  </span>\n                </button>\n              </div>\n\n              {/* Title and Result */}\n              <div>\n                <h3 className=\"font-medium text-white/90 line-clamp-2\">\n                  {market.title}\n                </h3>\n                <p\n                  className={`text-sm mt-1 ${\n                    market.outcome ? \"text-green-500\" : \"text-red-500\"\n                  }`}\n                >\n                  Resolved: {market.outcome ? \"YES\" : \"NO\"}\n                </p>\n              </div>\n\n              {/* Redeem button */}\n              {market.outcome !== null &&\n              (market.userYesBalance || market.userNoBalance) ? (\n                <button\n                  onClick={() => handleRedeem(market)}\n                  disabled={isRedeeming === market.seed}\n                  className=\"w-full bg-green-600/20 hover:bg-green-600/30 text-green-500 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                >\n                  {isRedeeming === market.seed\n                    ? \"Processing...\"\n                    : \"Redeem Winnings\"}\n                </button>\n              ) : (\n                <p className=\"text-white/60 text-sm text-center\">\n                  No tokens to redeem\n                </p>\n              )}\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div className=\"flex flex-col items-center justify-center py-20 text-center\">\n          <div className=\"w-16 h-16 mb-4 rounded-full bg-white/5 flex items-center justify-center\">\n            <svg\n              className=\"w-8 h-8 text-white/40\"\n              fill=\"none\"\n              viewBox=\"0 0 24 24\"\n              stroke=\"currentColor\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"\n              />\n            </svg>\n          </div>\n          <h3 className=\"text-xl font-medium text-white/90 mb-2\">\n            No Completed Markets\n          </h3>\n          <p className=\"text-white/60 max-w-sm\">\n            There are no completed markets yet. Markets will appear here once\n            they are resolved.\n          </p>\n        </div>\n      )}\n\n      {selectedMarketData && (\n        <CompletedMarketDetailsModal\n          isOpen={!!selectedMarket}\n          onClose={() => setSelectedMarket(null)}\n          market={selectedMarketData}\n          onRedeem={handleRedeem}\n          isRedeeming={isRedeeming === selectedMarketData.seed}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1041, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}